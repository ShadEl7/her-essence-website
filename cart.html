<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cart - Her Essence Restored (H.E.R.)</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <style>
    :root{
      --bg:#0c0c0c; --panel:#111; --muted:#b9b9b9; --text:#f1f1f1; --accent:#ffffff;
      --card:#161616; --border:#242424;
      --max:1200px; --gap:1.25rem;
    }

    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.5 'Cinzel', Georgia, serif;
      color:var(--text); background:linear-gradient(#1a1a1a, #0b0b0b 140vh);
    }
    a{color:inherit; text-decoration:none}
    img{display:block; width:100%; height:100%; object-fit:cover; object-position:center}
    .container{max-width:var(--max); margin-inline:auto; padding:0 1rem}
    .btn{
      display:inline-block; padding:.7rem 1.1rem; background:var(--accent); color:#000; border-radius:4px; font-weight:600;
    }
    .btn.outline{
      background:transparent; color:var(--accent); border:1px solid var(--accent);
    }
    /* Top announcement */
    .announcement{
      background:#0f0f0f; color:var(--muted); font-size:.85rem; text-align:center; padding:.6rem 1rem;
      border-bottom:1px solid var(--border);
    }

    /* Header */
    header{background:#000; border-bottom:1px solid var(--border)}
    .header-container{
      display:flex; flex-direction:column; align-items:center; padding:1rem 0; position:relative;
    }
    .logo{font-family:'Dancing Script', cursive; font-weight:700; letter-spacing:.04em; line-height:1; text-align:center; margin-bottom:1rem}
    .logo .brand{font-size:2.5rem; display:block; font-weight:bold}
    .logo small{font-size:.9rem; color:var(--muted); letter-spacing:.2em; font-family:'Cinzel', serif}
    .nav{
      display:flex; align-items:center; justify-content:center;
    }
    .nav ul{list-style:none; display:flex; gap:1.2rem; margin:0; padding:0; color:var(--muted)}
    .icons{display:flex; gap:1rem; color:var(--muted); position:absolute; right:2rem; top:1rem}
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 2rem;
      margin-left: 1rem;
      cursor: pointer;
      color: var(--burgundy);
    }
    #languageSelector {
      margin-left: 1rem;
      padding: 0.3rem 0.7rem;
      border: 1px solid var(--burgundy);
      border-radius: 5px;
      background: var(--white);
      color: var(--burgundy);
      font-size: 1rem;
    }
    .trending-now-banner {
      background: var(--soft-burgundy);
      color: var(--white);
      text-align: center;
      font-size: 1.15rem;
      padding: 0.7rem 0;
      margin-bottom: 0;
      letter-spacing: 0.5px;
    }
    .referral-block {
      background: var(--light-bg);
      border: 2px dashed var(--burgundy);
      color: var(--burgundy);
      text-align: center;
      margin-bottom: 1.2rem;
      padding: 1rem 0.5rem;
      border-radius: 8px;
    }
    .referral-btn {
      background: var(--burgundy);
      color: var(--white);
      border: none;
      border-radius: 5px;
      padding: 0.5rem 1.2rem;
      cursor: pointer;
      font-weight: 500;
      margin-top: 0.5rem;
    }
    .referral-btn:hover {
      background: var(--black);
    }
    .hero {
      padding: 3rem 2rem 2rem 2rem;
      text-align: center;
      max-width: 900px;
      margin: 0 auto;
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
    }
    .hero h1 {
      color: var(--burgundy);
      font-size: 2.2rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }
    .hero p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }
    .hero .cta-btn {
      background: var(--burgundy);
      color: var(--white);
      border: none;
      border-radius: 5px;
      padding: 0.8rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 1rem;
      transition: background 0.2s;
    }
    .hero .cta-btn:hover {
      background: var(--black);
      color: var(--white);
    }
    .countdown-banner {
      text-align: center;
      padding: 0.7rem 1rem;
      font-size: 1.1rem;
      background: var(--burgundy);
      color: var(--white);
      margin-bottom: 1.5rem;
      border-radius: 8px;
      max-width: 900px;
      margin: 1rem auto 1.5rem auto;
    }
    .carousel {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
      margin-bottom: 2rem;
    }
    .carousel-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      max-width: 900px;
      margin: 2rem auto;
      overflow: hidden;
    }
    .carousel-images {
      display: flex;
      transition: transform 0.5s;
      width: 100%;
    }
    .carousel-slide {
      min-width: 100%;
      box-sizing: border-box;
      position: relative;
    }
    .carousel-img {
      width: 100%;
      height: 320px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(128,0,32,0.07);
    }
    .carousel-arrow {
      background: none;
      border: none;
      cursor: pointer;
      z-index: 2;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.2s;
    }
    .carousel-arrow:hover {
      background: var(--soft-burgundy);
    }
    .carousel-dots {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .carousel-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--burgundy);
      opacity: 0.5;
      cursor: pointer;
      border: 2px solid var(--white);
      transition: opacity 0.2s;
    }
    .carousel-dot.active {
      opacity: 1;
      background: var(--black);
      border-color: var(--burgundy);
    }
    .carousel-overlay-left span,
    .carousel-overlay-right span {
      background: rgba(128,0,32,0.7);
      color: var(--white);
      padding: 0.3rem 0.7rem;
      border-radius: 5px;
      font-size: 1rem;
      position: absolute;
      top: 20px;
    }
    .carousel-overlay-left span { left: 20px; }
    .carousel-overlay-right span { right: 20px; }
    .carousel-caption span {
      background: rgba(255,255,255,0.92);
      color: var(--burgundy);
      padding: 0.3rem 0.7rem;
      border-radius: 5px;
      font-size: 1rem;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }
    .shop {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
    }
    .shop h2 {
      color: var(--burgundy);
      font-size: 1.6rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .filters {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .filters button {
      background: var(--burgundy);
      color: var(--white);
      border: none;
      border-radius: 5px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .filters button:hover,
    .filters button.active {
      background: var(--black);
      color: var(--white);
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }
    .product {
      padding: 1.2rem;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
      background: var(--white);
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid var(--soft-burgundy);
      transition: box-shadow 0.2s;
    }
    .product:hover {
      box-shadow: 0 4px 16px rgba(128,0,32,0.13);
    }
    .product h4 {
      color: var(--burgundy);
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0.7rem 0 0.3rem 0;
      text-align: center;
    }
    .product-description {
      color: var(--black);
      font-size: 1rem;
      text-align: center;
      margin-bottom: 0.7rem;
    }
    .product img {
      width: 100%;
      max-width: 220px;
      height: 220px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .share-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.7rem;
    }
    .share-buttons button {
      background: var(--white);
      border: 1px solid var(--burgundy);
      color: var(--burgundy);
      border-radius: 5px;
      padding: 0.3rem 0.7rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .share-buttons button:hover {
      background: var(--burgundy);
      color: var(--white);
    }
    .testimonials {
      max-width: 900px;
      margin: 2rem auto;
      padding: 2rem;
      border-radius: 12px;
      background: var(--white);
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
    }
    .testimonials h2 {
      color: var(--burgundy);
      font-size: 1.4rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1.2rem;
    }
    .testimonial-list {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .testimonial {
      flex: 1 1 220px;
      padding: 1rem;
      border-radius: 8px;
      background: var(--light-bg);
      border: 1px solid var(--soft-burgundy);
      font-size: 1rem;
      color: var(--black);
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(128,0,32,0.04);
    }
    .testimonial .author {
      color: var(--burgundy);
      font-weight: 600;
      margin-top: 0.5rem;
      font-size: 0.98rem;
    }
    .opt-in {
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      background: var(--burgundy);
      color: var(--white);
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
    }
    .opt-in h3 { color: var(--white); }
    .opt-in input, .opt-in button {
      margin: 0.5rem 0;
      padding: 0.7rem;
      border-radius: 5px;
      border: none;
      width: 90%;
      max-width: 350px;
      font-size: 1rem;
    }
    .opt-in input {
      background: var(--white);
      color: var(--burgundy);
      border: 1px solid var(--soft-burgundy);
    }
    .opt-in button {
      background: var(--black);
      color: var(--white);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .opt-in button:hover {
      background: var(--white);
      color: var(--burgundy);
    }
    .style-gallery {
      padding: 2rem 1rem;
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(128,0,32,0.07);
    }
    .style-gallery img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(128,0,32,0.07);
    }
    /* Footer */
    footer{padding:2.5rem 0; color:var(--muted); border-top:1px solid var(--border); background:#0a0a0a}

    /* Cart Specific Styles */
    .cart-container {
      max-width: var(--max);
      margin: 3rem auto;
      padding: 2rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    .cart-container h2 {
      font-family: 'Dancing Script', cursive;
      color: var(--text);
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border);
      padding-bottom: 1rem;
    }
    
    /* Enhanced Cart Styles */
    .cart-items {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .cart-item {
      display: grid;
      grid-template-columns: 100px 1fr auto auto auto;
      gap: 1rem;
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      align-items: center;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .item-image {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
    }

    .item-details h4 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem 0;
      color: var(--text);
      font-weight: bold;
    }

    .item-details p {
      margin: 0 0 0.3rem 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .item-details p:last-child {
      margin-bottom: 0;
    }

    .item-variant {
      color: var(--accent);
      font-weight: 500;
    }

    .item-price {
      font-weight: bold;
      color: var(--accent);
      font-size: 1.1rem;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .quantity-btn {
      background: var(--accent);
      border: none;
      color: #000;
      width: 30px;
      height: 30px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .quantity-btn:hover {
      background: var(--muted);
    }

    .quantity-input {
      width: 50px;
      text-align: center;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      padding: 0.3rem;
      border-radius: 4px;
    }

    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .remove-btn:hover {
      background: #c82333;
    }

    .empty-cart {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--muted);
    }

    .empty-cart h3 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--text);
      font-family: 'Dancing Script', cursive;
    }

    .cart-total-section {
      text-align: right;
      margin: 2rem 0;
      padding: 1.5rem;
      background: var(--panel);
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    .cart-total-section strong {
      font-size: 1.4rem;
      color: var(--accent);
    }
    
    .cart-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 2rem;
    }
    
    .checkout-btn {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 4px;
      padding: 0.8rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    .checkout-btn:hover {
      background: var(--muted);
      transform: translateY(-2px);
    }
    /* Responsive */
    @media (max-width: 1000px){
      .cart-item {
        grid-template-columns: 80px 1fr;
        gap: 1rem;
      }
      .cart-item .item-price,
      .cart-item .quantity-controls,
      .cart-item .remove-btn {
        grid-column: 2;
        justify-self: start;
        margin-top: 0.5rem;
      }
      .item-image {
        width: 80px;
        height: 80px;
      }
    }
    @media (max-width: 520px){
      .nav ul{display:none}
      .cart-container {
        margin: 1rem;
        padding: 1rem;
      }
      .cart-container h2 {
        font-size: 2rem;
      }
      .cart-buttons {
        flex-direction: column;
        align-items: center;
      }
      .checkout-btn {
        width: 100%;
        max-width: 300px;
        margin: 0.5rem 0;
      }
    }
  </style>
</head>
<body>

  <!-- Announcement -->
  <div class="announcement">✦ FREE SHIPPING ON ALL ORDERS OVER R999 ✦</div>

  <!-- Header -->
  <header>
    <div class="container header-container">
      <div class="logo">
        <span class="brand">H.E.R</span>
        <small>Her Essence Restored</small>
      </div>
      <div class="nav">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="products.html">Shop</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
      <div class="icons">
        <a href="#" class="search-icon" aria-label="Search">🔍</a>
        <a href="cart.html" class="cart-icon" aria-label="Cart">
          👜
          <span class="cart-count" style="display: none;"></span>
        </a>
      </div>
    </div>
  </header>

  <!-- Cart Section -->
  <section class="container">
    <div class="cart-container">
      <h2>Your Shopping Cart</h2>
      
      <div id="cart-content">
        <!-- Cart items will be dynamically inserted here -->
      </div>
      
      <div class="cart-total-section" id="cart-total-section" style="display:none;">
        <strong>Total: <span id="cartTotal">R0.00</span></strong>
      </div>
      
      <div class="cart-buttons" id="cart-buttons" style="display:none;">
        <button id="checkoutButton" class="checkout-btn">Proceed to Checkout</button>
        <button id="clearCartButton" class="checkout-btn">Clear Cart</button>
        <a href="products.html" class="checkout-btn" style="text-decoration:none; display:inline-block; text-align:center;">Continue Shopping</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div>© H.E.R - Her Essence Restored. All rights reserved.</div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
/* --- Enhanced Cart Page Logic --- */

function updateCartCount() {
  // Get cart from both possible storage locations
  const cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  
  // Calculate total quantity
  let totalCount = 0;
  cartItems.forEach(item => {
    const quantity = parseInt(item.qty || item.quantity) || 1;
    totalCount += quantity;
  });
  
  // Update cart count display
  const cartCountElement = document.querySelector('.cart-count');
  if (cartCountElement) {
    if (totalCount > 0) {
      cartCountElement.textContent = totalCount;
      cartCountElement.style.display = 'inline-block';
    } else {
      cartCountElement.textContent = '0';
      cartCountElement.style.display = 'inline-block';
    }
  }
}

// Enhanced Cart Functions
function renderCartPage() {
  const cartContent = document.getElementById('cart-content');
  // Check both cart storage keys for compatibility
  let cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  const totalSection = document.getElementById('cart-total-section');
  const buttonsSection = document.getElementById('cart-buttons');
  
  if (cartItems.length === 0) {
    cartContent.innerHTML = `
      <div class="empty-cart">
        <h3>Your cart is empty</h3>
        <p>Looks like you haven't added anything to your cart yet.</p>
        <div class="continue-shopping">
          <a href="products.html" class="checkout-btn" style="text-decoration:none; display:inline-block; padding:12px 24px;">Continue Shopping</a>
        </div>
      </div>
    `;
    totalSection.style.display = 'none';
    buttonsSection.style.display = 'none';
    return;
  }

  let cartHTML = '<div class="cart-items">';
  let total = 0;

  cartItems.forEach((item, index) => {
    // Handle both data structures for compatibility
    const price = parseFloat(item.priceNAD || item.price) || 0;
    const quantity = parseInt(item.qty || item.quantity) || 1;
    const size = item.size || 'N/A';
    const color = item.color || 'N/A';
    const itemTotal = price * quantity;
    total += itemTotal;
    
    // Create unique identifier for items with same product ID but different variants
    const itemKey = `${item.id}_${size}_${color}`;
    
    cartHTML += `
      <div class="cart-item">
        <div class="item-image">
          <img src="${item.image || ''}" alt="${item.name || 'Product'}">
        </div>
        <div class="item-details">
          <h4>${item.name || 'Product'}</h4>
          <p>Product ID: ${item.id || 'N/A'}</p>
          <p class="item-variant">Size: ${size} | Color: ${color}</p>
        </div>
        <div class="item-price">R${price.toFixed(2)}</div>
        <div class="quantity-controls">
          <button class="quantity-btn" onclick="updateCartQuantityByIndex(${index}, ${quantity - 1})">-</button>
          <input type="number" class="quantity-input" value="${quantity}" min="1" onchange="updateCartQuantityByIndex(${index}, this.value)">
          <button class="quantity-btn" onclick="updateCartQuantityByIndex(${index}, ${quantity + 1})">+</button>
        </div>
        <button class="remove-btn" onclick="removeFromCartByIndex(${index})">Remove</button>
      </div>
    `;
  });

  cartHTML += '</div>';
  cartContent.innerHTML = cartHTML;

  // Update total
  const shipping = total > 999 ? 0 : 50;
  const finalTotal = total + shipping;
  
  document.getElementById('cartTotal').textContent = `R${finalTotal.toFixed(2)}`;
  totalSection.style.display = 'block';
  buttonsSection.style.display = 'block';

  // Update subtotal info
  if (!document.getElementById('subtotal-info')) {
    const subtotalInfo = document.createElement('div');
    subtotalInfo.id = 'subtotal-info';
    subtotalInfo.style.cssText = 'margin-bottom: 1rem; color: var(--muted); font-size: 0.9rem;';
    subtotalInfo.innerHTML = `
      <div>Subtotal: R${total.toFixed(2)}</div>
      <div>Shipping: ${shipping === 0 ? 'FREE' : `R${shipping.toFixed(2)}`}</div>
      ${total <= 999 ? '<div style="color: var(--accent); font-weight: bold;">Free shipping on orders over R999!</div>' : ''}
    `;
    totalSection.insertBefore(subtotalInfo, totalSection.firstChild);
  } else {
    document.getElementById('subtotal-info').innerHTML = `
      <div>Subtotal: R${total.toFixed(2)}</div>
      <div>Shipping: ${shipping === 0 ? 'FREE' : `R${shipping.toFixed(2)}`}</div>
      ${total <= 999 ? '<div style="color: var(--accent); font-weight: bold;">Free shipping on orders over R999!</div>' : ''}
    `;
  }
}

function updateCartQuantityByIndex(itemIndex, newQuantity) {
  newQuantity = parseInt(newQuantity);
  if (newQuantity < 1) {
    removeFromCartByIndex(itemIndex);
    return;
  }
  
  // Get cart from both possible storage locations
  let cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  
  if (itemIndex >= 0 && itemIndex < cartItems.length) {
    // Update quantity using appropriate property name
    if (cartItems[itemIndex].hasOwnProperty('qty')) {
      cartItems[itemIndex].qty = newQuantity;
    }
    if (cartItems[itemIndex].hasOwnProperty('quantity')) {
      cartItems[itemIndex].quantity = newQuantity;
    }
    
    // Save to both storage keys for compatibility
    localStorage.setItem('cart', JSON.stringify(cartItems));
    localStorage.setItem('cartItems', JSON.stringify(cartItems));
    updateCartCount();
    renderCartPage();
  }
}

function removeFromCartByIndex(itemIndex) {
  // Get cart from both possible storage locations
  let cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  
  if (itemIndex >= 0 && itemIndex < cartItems.length) {
    cartItems.splice(itemIndex, 1);
    
    // Save to both storage keys for compatibility
    localStorage.setItem('cart', JSON.stringify(cartItems));
    localStorage.setItem('cartItems', JSON.stringify(cartItems));
    updateCartCount();
    renderCartPage();
    showMessage("Item removed from cart!", "success");
  }
}

function updateCartQuantity(productId, newQuantity) {
  newQuantity = parseInt(newQuantity);
  if (newQuantity < 1) {
    removeFromCart(productId);
    return;
  }
  
  // Get cart from both possible storage locations
  let cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  
  const itemIndex = cartItems.findIndex(item => item.id === productId);
  if (itemIndex !== -1) {
    // Update quantity using appropriate property name
    if (cartItems[itemIndex].hasOwnProperty('qty')) {
      cartItems[itemIndex].qty = newQuantity;
    }
    if (cartItems[itemIndex].hasOwnProperty('quantity')) {
      cartItems[itemIndex].quantity = newQuantity;
    }
    
    // Save to both storage keys for compatibility
    localStorage.setItem('cart', JSON.stringify(cartItems));
    localStorage.setItem('cartItems', JSON.stringify(cartItems));
    renderCartPage();
  }
}

function removeFromCart(productId) {
  // Get cart from both possible storage locations
  let cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  
  cartItems = cartItems.filter(item => item.id !== productId);
  
  // Save to both storage keys for compatibility
  localStorage.setItem('cart', JSON.stringify(cartItems));
  localStorage.setItem('cartItems', JSON.stringify(cartItems));
  updateCartCount();
  renderCartPage();
  showMessage("Item removed from cart!", "success");
}

function clearCart() {
  // Clear both storage keys
  localStorage.removeItem('cart');
  localStorage.removeItem('cartItems');
  updateCartCount();
  renderCartPage();
  showMessage("Cart cleared successfully!", "success");
}

function proceedCheckout() {
  // Get cart from both possible storage locations
  const cartItems = JSON.parse(localStorage.getItem('cart')) || JSON.parse(localStorage.getItem('cartItems')) || [];
  if (cartItems.length === 0) {
    alert("Your cart is empty.");
    return;
  }
  
  // Calculate total using appropriate price property
  let total = 0;
  cartItems.forEach(item => {
    const price = parseFloat(item.priceNAD || item.price) || 0;
    const quantity = parseInt(item.qty || item.quantity) || 1;
    total += price * quantity;
  });
  const shipping = total > 999 ? 0 : 50;
  const finalTotal = total + shipping;
  
  alert(
    "Thank you for shopping with H.E.R.!\n\n" +
    "Items: " + cartItems.length +
    "\nSubtotal: R" + total.toFixed(2) +
    "\nShipping: " + (shipping === 0 ? "FREE" : "R" + shipping.toFixed(2)) +
    "\nTotal: R" + finalTotal.toFixed(2) +
    "\n\n(This is a demo. No payment processed.)"
  );
  
  // Clear cart after checkout
  localStorage.removeItem('cart');
  localStorage.removeItem('cartItems');
  updateCartCount();
  renderCartPage();
}

function showMessage(message, type) {
  const notification = document.createElement('div');
  notification.className = 'cart-notification';
  notification.style.background = type === 'success' ? '#4CAF50' : '#ff4444';
  notification.innerHTML = `
    <div class="notification-content">
      <span class="check-icon">${type === 'success' ? '✓' : '!'}</span>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => document.body.removeChild(notification), 300);
  }, 3000);
}

// Event listeners
document.addEventListener("DOMContentLoaded", function() {
  updateCartCount();
  renderCartPage();
  
  // Add event listeners with null checks
  const clearButton = document.getElementById("clearCartButton");
  const checkoutButton = document.getElementById("checkoutButton");
  
  if (clearButton) {
    clearButton.onclick = clearCart;
  }
  
  if (checkoutButton) {
    checkoutButton.onclick = proceedCheckout;
  }
  
  // Initialize cart and search after scripts.js loads
  setTimeout(() => {
    updateCartCount();
    renderCartPage();
  }, 100);
});
  </script>
  
  <!-- Include our enhanced scripts -->
  <script src="../assets/js/scripts.js"></script>
</body>
</html>
